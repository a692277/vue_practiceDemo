{"version":3,"sources":["webpack:///static/js/cart.2d0e293e795b57f4df4d.js","webpack:///./src/modules/js/api.js?4c58**","webpack:///./src/modules/js/mixin.js?53fa*","webpack:///./src/pages/cart/cart.js"],"names":["webpackJsonp","0","module","__webpack_exports__","__webpack_require__","url","hotLists","banner","topList","subList","rank","searchList","details","deal","cartAdd","cartLists","cartReduce","cartRemove","cartMremove","key","hasOwnProperty","28","exports","29","3","mixin","filters","currency","price","priceStr","indexOf","arr","split","substr","30","62","Object","defineProperty","value","__WEBPACK_IMPORTED_MODULE_0__cart_base_css__","__WEBPACK_IMPORTED_MODULE_1__cart_trade_css__","n","__WEBPACK_IMPORTED_MODULE_2__cart_css__","__WEBPACK_IMPORTED_MODULE_3_vue__","__WEBPACK_IMPORTED_MODULE_4_js_mixin_js__","__WEBPACK_IMPORTED_MODULE_5_axios__","__WEBPACK_IMPORTED_MODULE_5_axios___default","__WEBPACK_IMPORTED_MODULE_6_js_api_js__","el","data","lists","editingShop","editingShopIndex","total","removePopup","removeMsg","removeData","computed","allSelected","get","this","length","every","shop","checked","set","newVal","forEach","goodsList","good","allRemoveSelected","removeChecked","selectLists","push","number","removeLists","created","getList","methods","_this","a","then","res","cartList","editing","editingMsg","selectGood","attr","selectShop","selectAll","console","log","edit","shopIndex","item","i","reduce","post","id","add","remove","goodIndex","removeList","removeConfirm","_this2","ids","findIndex","splice","removeShop","_removeData","mixins"],"mappings":"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","file":"static/js/cart.2d0e293e795b57f4df4d.js","sourcesContent":["webpackJsonp([4],{\n\n/***/ 0:\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nvar url = {\n  hotLists: '/index/hotLists',\n  banner: '/index/banner',\n  topList: '/category/topList',\n  subList: '/category/subList',\n  rank: '/category/rank',\n  searchList: '/search/list',\n  details: '/goods/details',\n  deal: '/goods/deal',\n  cartAdd: '/cart/add',\n  cartLists: '/cart/list',\n  cartReduce: '/cart/reduce',\n  cartRemove: '/cart/remove',\n  cartMremove: '/cart/mremove'\n\n  // 开发环境和真实环境的切换 RAp的接口的切换\n\n};var host = 'http://rapapi.org/mockjsdata/24170';\n\nfor (var key in url) {\n  if (url.hasOwnProperty(key)) {\n    url[key] = host + url[key];\n  }\n}\n// 所有url上面加上host\n/* harmony default export */ __webpack_exports__[\"a\"] = (url);\n\n/***/ }),\n\n/***/ 28:\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n\n/***/ 29:\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n\n/***/ 3:\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\n\nvar mixin = {\n  filters: {\n    currency: function currency(price) {\n      var priceStr = '' + price;\n      if (priceStr.indexOf('.') > -1) {\n        var arr = priceStr.split('.');\n        return arr[0] + '.' + (arr[1] + '0').substr(0, 2);\n      } else {\n        return priceStr + '.00';\n      }\n    }\n  }\n  //vue自带的currency\n};/* harmony default export */ __webpack_exports__[\"a\"] = (mixin);\n\n/***/ }),\n\n/***/ 30:\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n\n/***/ 62:\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nObject.defineProperty(__webpack_exports__, \"__esModule\", { value: true });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__cart_base_css__ = __webpack_require__(29);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__cart_base_css___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0__cart_base_css__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__cart_trade_css__ = __webpack_require__(30);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__cart_trade_css___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1__cart_trade_css__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__cart_css__ = __webpack_require__(28);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__cart_css___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2__cart_css__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_vue__ = __webpack_require__(1);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4_js_mixin_js__ = __webpack_require__(3);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5_axios__ = __webpack_require__(4);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5_axios___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_5_axios__);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6_js_api_js__ = __webpack_require__(0);\n\n\n\n\n\n\n\n\n\n//没有结算部分\n\nnew __WEBPACK_IMPORTED_MODULE_3_vue__[\"default\"]({\n  el: '.vue-cart',\n  data: {\n    lists: null,\n    editingShop: null,\n    editingShopIndex: -1,\n    total: 0,\n    removePopup: false,\n    removeMsg: '',\n    removeData: null\n  },\n  computed: {\n    //全选\n    allSelected: {\n      get: function get() {\n        //遍历店铺，如果店铺都被选中，则选中\n        if (this.lists && this.lists.length) {\n          return this.lists.every(function (shop) {\n            return shop.checked;\n          });\n        }\n        return false;\n      },\n      set: function set(newVal) {\n        //所有商品和店铺根据当前值，赋相应的true/false\n        this.lists.forEach(function (shop) {\n          shop.checked = newVal;\n          shop.goodsList.forEach(function (good) {\n            good.checked = newVal;\n          });\n        });\n      }\n    },\n    allRemoveSelected: {\n      get: function get() {\n        if (this.editingShop) {\n          return this.editingShop.removeChecked;\n        }\n        return false;\n      },\n      set: function set(newVal) {\n        if (this.editingShop) {\n          this.editingShop.removeChecked = newVal;\n          this.editingShop.goodsList.forEach(function (good) {\n            good.removeChecked = newVal;\n          });\n          return;\n        }\n      }\n    },\n    selectLists: function selectLists() {\n      //选中的商品列表\n      if (!(this.lists && this.lists.length)) return [];\n      var arr = [];\n      var total = 0;\n      this.lists.forEach(function (shop) {\n        shop.goodsList.forEach(function (good) {\n          //店铺中的商品是否被选中\n          if (good.checked) {\n            arr.push(good);\n            total += good.price * good.number;\n          }\n        });\n      });\n      //遍历完返回数组\n      this.total = total;\n      return arr;\n    },\n    removeLists: function removeLists() {\n      if (!this.editingShop) {\n        return [];\n      } else {\n        var arr = [];\n        this.editingShop.goodsList.forEach(function (good) {\n          if (good.removeChecked) {\n            arr.push(good);\n          }\n        });\n        return arr;\n      }\n    }\n  },\n  created: function created() {\n    this.getList();\n  },\n\n  methods: {\n    getList: function getList() {\n      var _this = this;\n\n      __WEBPACK_IMPORTED_MODULE_5_axios___default.a.get(__WEBPACK_IMPORTED_MODULE_6_js_api_js__[\"a\" /* default */].cartLists).then(function (res) {\n        var lists = res.data.cartList;\n        //先拿到原始数据，再进行操作（添加属性），操作完再赋值给lists\n        lists.forEach(function (shop) {\n          shop.checked = true;\n          shop.removeChecked = false;\n          shop.editing = false;\n          shop.editingMsg = '编辑';\n          shop.goodsList.forEach(function (good) {\n            good.checked = true;\n            good.removeChecked = false;\n          });\n        });\n        _this.lists = lists;\n      });\n    },\n    selectGood: function selectGood(shop, good) {\n      var attr = this.editingShop ? 'removeChecked' : 'checked';\n      good[attr] = !good[attr];\n      shop[attr] = shop.goodsList.every(function (good) {\n        //遍历shop中的每一个good，\n        return good[attr];\n      });\n    },\n    selectShop: function selectShop(shop) {\n      var attr = this.editingShop ? 'removeChecked' : 'checked';\n      shop[attr] = !shop[attr];\n      shop.goodsList.forEach(function (good) {\n        good[attr] = shop[attr];\n      });\n    },\n    selectAll: function selectAll() {\n      var attr = this.editingShop ? 'allRemoveSelected' : 'allSelected';\n      console.log(attr);\n      this[attr] = !this[attr];\n    },\n    edit: function edit(shop, shopIndex) {\n      shop.editing = !shop.editing;\n      shop.editingMsg = shop.editing ? '完成' : '编辑';\n      this.lists.forEach(function (item, i) {\n        if (shopIndex !== i) {\n          item.editing = false;\n          item.editingMsg = shop.editing ? '' : '编辑';\n        }\n      });\n      this.editingShop = shop.editing ? shop : null;\n      this.editingShopIndex = shop.editing ? shopIndex : -1;\n    },\n    reduce: function reduce(good) {\n      if (good.number === 1) return;\n      __WEBPACK_IMPORTED_MODULE_5_axios___default.a.post(__WEBPACK_IMPORTED_MODULE_6_js_api_js__[\"a\" /* default */].cartReduce, {\n        id: good.id,\n        number: 1\n      }).then(function (res) {\n        good.number--;\n      });\n    },\n    add: function add(good) {\n      __WEBPACK_IMPORTED_MODULE_5_axios___default.a.post(__WEBPACK_IMPORTED_MODULE_6_js_api_js__[\"a\" /* default */].cartAdd, {\n        id: good.id,\n        number: 1\n      }).then(function (res) {\n        good.number++;\n      });\n    },\n    remove: function remove(shop, shopIndex, good, goodIndex) {\n      this.removePopup = true;\n      this.removeMsg = '确定要删除该商品吗？';\n      this.removeData = { shop: shop, shopIndex: shopIndex, good: good, goodIndex: goodIndex };\n    },\n    removeList: function removeList() {\n      this.removePopup = true;\n      this.removeMsg = '\\u786E\\u5B9A\\u5C06\\u6240\\u9009 ' + this.removeLists.length + ' \\u4E2A\\u5546\\u54C1\\u5220\\u9664\\uFF1F';\n    },\n    removeConfirm: function removeConfirm() {\n      var _this2 = this;\n\n      if (this.removeMsg !== '确定要删除该商品吗？') {\n        var ids = [];\n        this.removeLists.forEach(function (good) {\n          ids.push(good.id);\n        });\n        __WEBPACK_IMPORTED_MODULE_5_axios___default.a.post(__WEBPACK_IMPORTED_MODULE_6_js_api_js__[\"a\" /* default */].cartMremove, { ids: ids }).then(function (res) {\n          var arr = [];\n          _this2.editingShop.goodsList.forEach(function (good) {\n            var index = _this2.removeLists.findIndex(function (item) {\n              return item.id == good.id;\n            });\n            if (index == -1) {\n              arr.push(good);\n            }\n          });\n          if (arr.length) {\n            _this2.editingShop.goodsList = arr;\n          } else {\n            _this2.lists.splice(_this2.editingShopIndex, 1);\n            _this2.removeShop();\n          }\n          _this2.removePopup = false;\n        });\n      } else {\n        var _removeData = this.removeData,\n            shop = _removeData.shop,\n            shopIndex = _removeData.shopIndex,\n            good = _removeData.good,\n            goodIndex = _removeData.goodIndex;\n\n        __WEBPACK_IMPORTED_MODULE_5_axios___default.a.post(__WEBPACK_IMPORTED_MODULE_6_js_api_js__[\"a\" /* default */].cartRemove, {\n          id: good.id\n        }).then(function (res) {\n          shop.goodsList.splice(goodIndex, 1);\n          if (!shop.goodsList.length) {\n            _this2.lists.splice(shopIndex, 1);\n            _this2.removeShop();\n          }\n          _this2.removePopup = false;\n        });\n      }\n    },\n    removeShop: function removeShop() {\n      this.editingShop = null;\n      this.editingShopIndex = -1;\n      this.lists.forEach(function (item, i) {\n        item.editing = false;\n        item.editingMsg = '编辑';\n      });\n    }\n  },\n  mixins: [__WEBPACK_IMPORTED_MODULE_4_js_mixin_js__[\"a\" /* default */]]\n});\n\n/***/ })\n\n},[62]);\n\n\n// WEBPACK FOOTER //\n// static/js/cart.2d0e293e795b57f4df4d.js","let url = {\r\n  hotLists: '/index/hotLists',\r\n  banner: '/index/banner',\r\n  topList: '/category/topList',\r\n  subList: '/category/subList',\r\n  rank: '/category/rank',\r\n  searchList: '/search/list',\r\n  details: '/goods/details',\r\n  deal: '/goods/deal',\r\n  cartAdd: '/cart/add',\r\n  cartLists: '/cart/list',\r\n  cartReduce: '/cart/reduce',\r\n  cartRemove: '/cart/remove',\r\n  cartMremove: '/cart/mremove'\r\n}\r\n\r\n\r\n\r\n// 开发环境和真实环境的切换 RAp的接口的切换\r\n\r\nlet host = 'http://rapapi.org/mockjsdata/24170'\r\n\r\n\r\nfor (let key in url) {\r\n\tif (url.hasOwnProperty(key)) {\r\n       url[key] = host + url[key]\r\n\t}\r\n}\r\n// 所有url上面加上host\r\nexport default url\n\n\n// WEBPACK FOOTER //\n// ./src/modules/js/api.js","\r\nlet mixin = {\r\n  filters: {\r\n    currency(price) {\r\n      let priceStr = '' + price\r\n      if (priceStr.indexOf('.') > -1) {\r\n        let arr = priceStr.split('.')\r\n        return arr[0] + '.' + (arr[1] + '0').substr(0, 2)\r\n      } else {\r\n        return priceStr + '.00'\r\n      }\r\n    }\r\n  }\r\n}\r\n//vue自带的currency\r\nexport default mixin\n\n\n// WEBPACK FOOTER //\n// ./src/modules/js/mixin.js","import './cart_base.css'\r\nimport './cart_trade.css'\r\nimport './cart.css'\r\n\r\nimport Vue from 'vue'\r\nimport mixin from 'js/mixin.js'\r\nimport axios from 'axios'\r\nimport url from 'js/api.js'\r\n\r\n//没有结算部分\r\n\r\nnew Vue({\r\n  el: '.vue-cart',\r\n  data: {\r\n    lists: null,\r\n    editingShop: null,\r\n    editingShopIndex: -1,\r\n    total: 0,\r\n    removePopup: false,\r\n    removeMsg: '',\r\n    removeData: null\r\n  },\r\n  computed: {\r\n    //全选\r\n    allSelected: {\r\n      get() {\r\n        //遍历店铺，如果店铺都被选中，则选中\r\n        if (this.lists && this.lists.length) {\r\n          return this.lists.every(shop => {\r\n            return shop.checked\r\n          })\r\n        }\r\n        return false\r\n      },\r\n      set(newVal) {\r\n         //所有商品和店铺根据当前值，赋相应的true/false\r\n        this.lists.forEach(shop => {\r\n          shop.checked = newVal\r\n          shop.goodsList.forEach(good => {\r\n            good.checked = newVal\r\n          })\r\n        })\r\n      }\r\n    },\r\n    allRemoveSelected: {\r\n      get() {\r\n        if (this.editingShop) {\r\n          return this.editingShop.removeChecked\r\n        }\r\n        return false\r\n      },\r\n      set(newVal) {\r\n        if (this.editingShop) {\r\n          this.editingShop.removeChecked = newVal\r\n          this.editingShop.goodsList.forEach(good => {\r\n            good.removeChecked = newVal\r\n          })\r\n          return\r\n        }\r\n      }\r\n    },\r\n    selectLists() {\r\n       //选中的商品列表\r\n      if (!(this.lists && this.lists.length)) return []\r\n      let arr = []\r\n      let total = 0\r\n      this.lists.forEach(shop => {\r\n        shop.goodsList.forEach(good => {\r\n          //店铺中的商品是否被选中\r\n          if (good.checked) {\r\n            arr.push(good)\r\n            total += good.price * good.number\r\n          }\r\n        })\r\n      })\r\n      //遍历完返回数组\r\n      this.total = total\r\n      return arr\r\n    },\r\n    removeLists() {\r\n      if (!this.editingShop) {\r\n        return []\r\n      } else {\r\n        let arr = []\r\n        this.editingShop.goodsList.forEach(good => {\r\n          if (good.removeChecked) {\r\n            arr.push(good)\r\n          }\r\n        })\r\n        return arr\r\n      }\r\n    }\r\n  },\r\n  created() {\r\n    this.getList()\r\n  },\r\n  methods: {\r\n    getList() {\r\n      axios.get(url.cartLists).then(res => {\r\n        let lists = res.data.cartList\r\n         //先拿到原始数据，再进行操作（添加属性），操作完再赋值给lists\r\n        lists.forEach(shop => {\r\n          shop.checked = true\r\n          shop.removeChecked = false\r\n          shop.editing = false\r\n          shop.editingMsg = '编辑'\r\n          shop.goodsList.forEach(good => {\r\n            good.checked = true\r\n            good.removeChecked = false\r\n          })\r\n        })\r\n        this.lists = lists\r\n      })\r\n    },\r\n    selectGood(shop, good) {\r\n      let attr = this.editingShop ? 'removeChecked' : 'checked'\r\n      good[attr] = !good[attr]\r\n      shop[attr] = shop.goodsList.every(good => {\r\n      //遍历shop中的每一个good，\r\n        return good[attr]\r\n      })\r\n    },\r\n    selectShop(shop) {\r\n      let attr = this.editingShop ? 'removeChecked' : 'checked'\r\n      shop[attr] = !shop[attr]\r\n      shop.goodsList.forEach(good => {\r\n        good[attr] = shop[attr]\r\n      })\r\n    },\r\n    selectAll() {\r\n      let attr = this.editingShop ? 'allRemoveSelected' : 'allSelected'\r\n      console.log(attr)\r\n      this[attr] = !this[attr]\r\n    },\r\n    edit(shop, shopIndex) {\r\n      shop.editing = !shop.editing\r\n      shop.editingMsg = shop.editing ? '完成' : '编辑'\r\n      this.lists.forEach((item, i) => {\r\n        if (shopIndex !== i) {\r\n          item.editing = false\r\n          item.editingMsg = shop.editing ? '' : '编辑'\r\n        }\r\n      })\r\n      this.editingShop = shop.editing ? shop : null\r\n      this.editingShopIndex = shop.editing ? shopIndex : -1\r\n    },\r\n    reduce(good) {\r\n      if (good.number === 1) return\r\n      axios.post(url.cartReduce, {\r\n        id: good.id,\r\n        number: 1\r\n      }).then(res => {\r\n        good.number--\r\n      })\r\n    },\r\n    add(good) {\r\n      axios.post(url.cartAdd, {\r\n        id: good.id,\r\n        number: 1\r\n      }).then(res => {\r\n        good.number++\r\n      })\r\n    },\r\n    remove(shop, shopIndex, good, goodIndex) {\r\n      this.removePopup = true\r\n      this.removeMsg = '确定要删除该商品吗？'\r\n      this.removeData = { shop, shopIndex, good, goodIndex }\r\n    },\r\n    removeList() {\r\n      this.removePopup = true\r\n      this.removeMsg = `确定将所选 ${this.removeLists.length} 个商品删除？`\r\n    },\r\n    removeConfirm() {\r\n      if (this.removeMsg !== '确定要删除该商品吗？') {\r\n        let ids = []\r\n        this.removeLists.forEach(good => {\r\n          ids.push(good.id)\r\n        })\r\n        axios.post(url.cartMremove, { ids }).then(res => {\r\n          let arr = []\r\n          this.editingShop.goodsList.forEach(good => {\r\n            let index = this.removeLists.findIndex(item => {\r\n              return item.id == good.id\r\n            })\r\n            if (index == -1) {\r\n              arr.push(good)\r\n            }\r\n          })\r\n          if (arr.length) {\r\n            this.editingShop.goodsList = arr\r\n          } else {\r\n            this.lists.splice(this.editingShopIndex, 1)\r\n            this.removeShop()\r\n          }\r\n          this.removePopup = false\r\n        })\r\n      } else {\r\n        let { shop, shopIndex, good, goodIndex } = this.removeData\r\n        axios.post(url.cartRemove, {\r\n          id: good.id\r\n        }).then(res => {\r\n          shop.goodsList.splice(goodIndex, 1)\r\n          if (!shop.goodsList.length) {\r\n            this.lists.splice(shopIndex, 1)\r\n            this.removeShop()\r\n          }\r\n          this.removePopup = false\r\n        })\r\n      }\r\n    },\r\n    removeShop() {\r\n      this.editingShop = null\r\n      this.editingShopIndex = -1\r\n      this.lists.forEach((item, i) => {\r\n        item.editing = false\r\n        item.editingMsg = '编辑'\r\n      })\r\n    }\r\n  },\r\n  mixins: [mixin]\r\n})\n\n\n// WEBPACK FOOTER //\n// ./src/pages/cart/cart.js"],"sourceRoot":""}